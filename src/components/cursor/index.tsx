import { useSessionStorageValue } from '@react-hookz/web'
import { useInterval } from 'ahooks'
import { gsap } from 'gsap/dist/gsap'
// import { MorphSVGPlugin } from 'gsap/dist/MorphSVGPlugin'
import { useLayoutEffect, useMemo, useRef, useState } from 'react'

if (typeof window !== 'undefined') {
  // gsap.registerPlugin(MorphSVGPlugin)
}

const cursors = {
  '': (
    <svg
      width={32}
      height={32}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M12 7C10.9506 7 9.92778 7.33019 9.07645 7.94379C8.22512 8.55739 7.58844 9.4233 7.25658 10.4189C6.92473 11.4144 6.91453 12.4892 7.22743 13.4908C7.54033 14.4925 8.16047 15.3704 9 16V20C9 20.5304 9.21071 21.0391 9.58579 21.4142C9.96086 21.7893 10.4696 22 11 22H13C13.5304 22 14.0391 21.7893 14.4142 21.4142C14.7893 21.0391 15 20.5304 15 20V16C15.8395 15.3704 16.4597 14.4925 16.7726 13.4908C17.0855 12.4892 17.0753 11.4144 16.7434 10.4189C16.4116 9.4233 15.7749 8.55739 14.9236 7.94379C14.0722 7.33019 13.0494 7 12 7Z"
        fill="currentColor"
      />
      <path
        d="M12 6C12.2652 6 12.5196 5.89464 12.7071 5.70711C12.8946 5.51957 13 5.26522 13 5V3C13 2.73478 12.8946 2.48043 12.7071 2.29289C12.5196 2.10536 12.2652 2 12 2C11.7348 2 11.4804 2.10536 11.2929 2.29289C11.1054 2.48043 11 2.73478 11 3V5C11 5.26522 11.1054 5.51957 11.2929 5.70711C11.4804 5.89464 11.7348 6 12 6Z"
        fill="currentColor"
      />
      <path
        d="M21 11H19C18.7348 11 18.4804 11.1054 18.2929 11.2929C18.1054 11.4804 18 11.7348 18 12C18 12.2652 18.1054 12.5196 18.2929 12.7071C18.4804 12.8946 18.7348 13 19 13H21C21.2652 13 21.5196 12.8946 21.7071 12.7071C21.8946 12.5196 22 12.2652 22 12C22 11.7348 21.8946 11.4804 21.7071 11.2929C21.5196 11.1054 21.2652 11 21 11Z"
        fill="black"
      />
      <path
        d="M5 11H3C2.73478 11 2.48043 11.1054 2.29289 11.2929C2.10536 11.4804 2 11.7348 2 12C2 12.2652 2.10536 12.5196 2.29289 12.7071C2.48043 12.8946 2.73478 13 3 13H5C5.26522 13 5.51957 12.8946 5.70711 12.7071C5.89464 12.5196 6 12.2652 6 12C6 11.7348 5.89464 11.4804 5.70711 11.2929C5.51957 11.1054 5.26522 11 5 11Z"
        fill="currentColor"
      />
      <path
        d="M7.65999 6.42001L6.21999 5.00001C6.02505 4.81568 5.76488 4.71634 5.4967 4.72385C5.22852 4.73135 4.97431 4.84507 4.78999 5.04001C4.60566 5.23494 4.50632 5.49512 4.51382 5.76329C4.52133 6.03147 4.63505 6.28568 4.82999 6.47001L6.26999 7.86001C6.36662 7.95332 6.48107 8.0262 6.60649 8.07431C6.73191 8.12242 6.86574 8.14476 6.99999 8.14001C7.13469 8.13949 7.2679 8.11177 7.39163 8.0585C7.51535 8.00523 7.62704 7.92751 7.71999 7.83001C7.89849 7.63483 7.9924 7.37688 7.98115 7.11262C7.96991 6.84836 7.85442 6.59932 7.65999 6.42001Z"
        fill="currentColor"
      />
      <path
        d="M19.19 5.05001C19.0026 4.86376 18.7492 4.75922 18.485 4.75922C18.2208 4.75922 17.9673 4.86376 17.78 5.05001L16.34 6.42001C16.1537 6.60737 16.0492 6.86082 16.0492 7.12501C16.0492 7.38919 16.1537 7.64265 16.34 7.83001C16.4329 7.92751 16.5446 8.00523 16.6683 8.0585C16.7921 8.11177 16.9253 8.1395 17.06 8.14001C17.3175 8.13898 17.5646 8.03869 17.75 7.86001L19.19 6.47001C19.2837 6.37705 19.3581 6.26644 19.4089 6.14459C19.4596 6.02273 19.4858 5.89202 19.4858 5.76001C19.4858 5.628 19.4596 5.49729 19.4089 5.37543C19.3581 5.25357 19.2837 5.14297 19.19 5.05001Z"
        fill="currentColor"
      />
    </svg>
  ),
  developer: (
    <svg
      width={32}
      height={32}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M11.0001 4L10.5001 3L10.0001 4L9.00006 4.125L9.83406 4.833L9.50006 6L10.5001 5.334L11.5001 6L11.1661 4.833L12.0001 4.125L11.0001 4ZM19.3341 14.666L18.5001 13L17.6661 14.666L16.0001 14.875L17.3891 16.056L16.8341 18L18.5001 16.889L20.1661 18L19.6111 16.056L21.0001 14.875L19.3341 14.666ZM6.66706 6.333L6.00006 5L5.33306 6.333L4.00006 6.5L5.11106 7.444L4.66706 9L6.00006 8.111L7.33306 9L6.88906 7.444L8.00006 6.5L6.66706 6.333ZM3.41406 17C3.41406 17.534 3.62206 18.036 4.00006 18.414L5.58606 20C5.96406 20.378 6.46606 20.586 7.00006 20.586C7.53406 20.586 8.03606 20.378 8.41406 20L20.0001 8.414C20.3781 8.036 20.5861 7.534 20.5861 7C20.5861 6.466 20.3781 5.964 20.0001 5.586L18.4141 4C17.6581 3.244 16.3421 3.244 15.5861 4L4.00006 15.586C3.62206 15.964 3.41406 16.466 3.41406 17ZM17.0001 5.414L18.5861 7L15.0001 10.586L13.4141 9L17.0001 5.414Z"
        fill="currentColor"
      />
    </svg>
  ),
  writer: (
    <svg
      width={32}
      height={32}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M19.4001 7.34001L16.6601 4.60001C16.3024 4.26411 15.8338 4.07137 15.3434 4.05846C14.8529 4.04556 14.3748 4.21338 14.0001 4.53001L5.00005 13.53C4.67682 13.856 4.47556 14.2832 4.43005 14.74L4.00005 18.91C3.98658 19.0565 4.00559 19.2041 4.05571 19.3424C4.10584 19.4807 4.18585 19.6062 4.29005 19.71C4.38349 19.8027 4.49431 19.876 4.61615 19.9258C4.73798 19.9755 4.86845 20.0008 5.00005 20H5.09005L9.26005 19.62C9.71685 19.5745 10.1441 19.3732 10.4701 19.05L19.4701 10.05C19.8194 9.68098 20.0082 9.18852 19.995 8.68055C19.9819 8.17257 19.768 7.69052 19.4001 7.34001ZM16.0001 10.68L13.3201 8.00001L15.2701 6.00001L18.0001 8.73001L16.0001 10.68Z"
        fill="currentColor"
      />
    </svg>
  ),
  designer: (
    <svg
      width={32}
      height={32}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M7.11991 12.55C6.25045 12.7578 5.47567 13.2509 4.91921 13.9505C4.36276 14.6502 4.05671 15.5161 4.04991 16.41V19.52C4.04855 19.5834 4.06003 19.6464 4.08367 19.7053C4.10731 19.7641 4.14262 19.8176 4.18746 19.8624C4.23231 19.9073 4.28577 19.9426 4.34462 19.9662C4.40348 19.9899 4.46651 20.0014 4.52991 20L7.76991 19.94C8.49376 19.9412 9.20273 19.7345 9.81254 19.3445C10.4223 18.9545 10.9074 18.3976 11.2099 17.74C11.5204 17.1203 11.648 16.4249 11.5777 15.7353C11.5075 15.0457 11.2423 14.3904 10.8133 13.846C10.3843 13.3016 9.80908 12.8905 9.15502 12.661C8.50095 12.4315 7.79506 12.393 7.11991 12.55Z"
        fill="currentColor"
      />
      <path
        d="M19.2601 4.46C18.8405 4.12911 18.3123 3.96717 17.7793 4.00604C17.2464 4.0449 16.7472 4.28174 16.3801 4.67L10.0001 11.08C9.91336 11.1679 9.86475 11.2865 9.86475 11.41C9.86475 11.5335 9.91336 11.6521 10.0001 11.74L12.2501 14C12.338 14.0867 12.4566 14.1353 12.5801 14.1353C12.7036 14.1353 12.8221 14.0867 12.9101 14L19.4001 7.53C19.5924 7.33685 19.7444 7.10746 19.8474 6.85513C19.9504 6.6028 20.0023 6.33254 20.0001 6.06C20.0072 5.7545 19.9442 5.45143 19.8159 5.17407C19.6876 4.89672 19.4975 4.65244 19.2601 4.46Z"
        fill="currentColor"
      />
    </svg>
  ),
}

const cursors2 = {
  writer:
    'M19.4001 7.34001L16.6601 4.60001C16.3024 4.26411 15.8338 4.07137 15.3434 4.05846C14.8529 4.04556 14.3748 4.21338 14.0001 4.53001L5.00005 13.53C4.67682 13.856 4.47556 14.2832 4.43005 14.74L4.00005 18.91C3.98658 19.0565 4.00559 19.2041 4.05571 19.3424C4.10584 19.4807 4.18585 19.6062 4.29005 19.71C4.38349 19.8027 4.49431 19.876 4.61615 19.9258C4.73798 19.9755 4.86845 20.0008 5.00005 20H5.09005L9.26005 19.62C9.71685 19.5745 10.1441 19.3732 10.4701 19.05L19.4701 10.05C19.8194 9.68098 20.0082 9.18852 19.995 8.68055C19.9819 8.17257 19.768 7.69052 19.4001 7.34001ZM16.0001 10.68L13.3201 8.00001L15.2701 6.00001L18.0001 8.73001L16.0001 10.68Z',
  developer:
    'M11.0001 4L10.5001 3L10.0001 4L9.00006 4.125L9.83406 4.833L9.50006 6L10.5001 5.334L11.5001 6L11.1661 4.833L12.0001 4.125L11.0001 4ZM19.3341 14.666L18.5001 13L17.6661 14.666L16.0001 14.875L17.3891 16.056L16.8341 18L18.5001 16.889L20.1661 18L19.6111 16.056L21.0001 14.875L19.3341 14.666ZM6.66706 6.333L6.00006 5L5.33306 6.333L4.00006 6.5L5.11106 7.444L4.66706 9L6.00006 8.111L7.33306 9L6.88906 7.444L8.00006 6.5L6.66706 6.333ZM3.41406 17C3.41406 17.534 3.62206 18.036 4.00006 18.414L5.58606 20C5.96406 20.378 6.46606 20.586 7.00006 20.586C7.53406 20.586 8.03606 20.378 8.41406 20L20.0001 8.414C20.3781 8.036 20.5861 7.534 20.5861 7C20.5861 6.466 20.3781 5.964 20.0001 5.586L18.4141 4C17.6581 3.244 16.3421 3.244 15.5861 4L4.00006 15.586C3.62206 15.964 3.41406 16.466 3.41406 17ZM17.0001 5.414L18.5861 7L15.0001 10.586L13.4141 9L17.0001 5.414Z',
  designer:
    'M7.11991 12.55C6.25045 12.7578 5.47567 13.2509 4.91921 13.9505C4.36276 14.6502 4.05671 15.5161 4.04991 16.41V19.52C4.04855 19.5834 4.06003 19.6464 4.08367 19.7053C4.10731 19.7641 4.14262 19.8176 4.18746 19.8625C4.23231 19.9073 4.28577 19.9426 4.34462 19.9662C4.40348 19.9899 4.46651 20.0014 4.52991 20L7.76991 19.94C8.49376 19.9412 9.20273 19.7345 9.81254 19.3445C10.4223 18.9545 10.9074 18.3976 11.2099 17.74C11.5204 17.1203 11.648 16.4249 11.5777 15.7353C11.5075 15.0457 11.2423 14.3904 10.8133 13.846C10.3843 13.3016 9.80908 12.8906 9.15502 12.661C8.50095 12.4315 7.79506 12.393 7.11991 12.55V12.55ZM19.2599 4.46C18.8403 4.12911 18.3121 3.96717 17.7792 4.00604C17.2462 4.0449 16.7471 4.28174 16.3799 4.67L9.99991 11.08C9.91319 11.1679 9.86458 11.2865 9.86458 11.41C9.86458 11.5335 9.91319 11.6521 9.99991 11.74L12.2499 14C12.3379 14.0867 12.4564 14.1353 12.5799 14.1353C12.7034 14.1353 12.822 14.0867 12.9099 14L19.3999 7.53C19.5922 7.33685 19.7442 7.10746 19.8472 6.85513C19.9502 6.6028 20.0021 6.33254 19.9999 6.06C20.007 5.7545 19.944 5.45143 19.8157 5.17407C19.6874 4.89672 19.4973 4.65244 19.2599 4.46V4.46Z',
}

const Cursor = () => {
  const cursorRef = useRef()
  const q = useMemo(() => gsap.utils.selector(cursorRef), [])

  const mouseRef = useRef({
    x: 0,
    y: 0,
  })
  const [path] = useSessionStorageValue('path', '')

  const [hideCursor, setHideCursor] = useState(false)

  useLayoutEffect(() => {
    if (hideCursor) {
      gsap.fromTo(
        cursorRef.current,
        { opacity: 1, scale: 1 },
        { opacity: 0, scale: 0, duration: 0.5, ease: 'power2.easeInOut' },
      )
    } else {
      gsap.fromTo(
        cursorRef.current,
        { opacity: 0, scale: 0 },
        { opacity: 1, scale: 1, duration: 0.5, ease: 'power2.easeInOut' },
      )
      const pos = { x: window.innerWidth / 2, y: window.innerHeight / 2 }
      mouseRef.current = { x: pos.x, y: pos.y }

      gsap.set(cursorRef.current, { xPercent: -50, yPercent: -50 })
      const speed = 0.1
      const fpms = 60 / 1000

      const xSet = gsap.quickSetter(cursorRef.current, 'x', 'px')
      const ySet = gsap.quickSetter(cursorRef.current, 'y', 'px')

      window.addEventListener('mousemove', (e) => {
        mouseRef.current = {
          x: e.x,
          y: e.y,
        }
      })

      gsap.ticker.add((time, deltaTime) => {
        const delta = deltaTime * fpms
        const dt = 1.0 - Math.pow(1.0 - speed, delta)

        pos.x += (mouseRef.current.x - pos.x) * dt
        pos.y += (mouseRef.current.y - pos.y) * dt
        xSet(pos.x)
        ySet(pos.y)
      })
    }
  }, [hideCursor])

  useLayoutEffect(() => {
    gsap.to(q('#cursor-path'), {
      duration: 0.5,
      morphSVG: '#circle',
    })
    gsap.to(q('#cursor-path'), {
      duration: 0.5,
      delay: 0.2,
      morphSVG: cursors2[path],
    })
  }, [path, q])

  useInterval(() => {
    setHideCursor(window.location.pathname.includes('/posts'))
  }, 500)

  return (
    <div
      ref={cursorRef}
      className={`w-10 h-10 text-main-1000 grid place-content-center fixed top-0 left-0 rounded-full z-[100000] ${
        path == '' ? 'bg-[#b1b1b1]' : 'bg-main-hex'
      }  bg-opacity-50 pointer-events-none`}
    >
      <svg
        width={32}
        height={32}
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        {/* <path
          id="cursor-path"
          d="M11.0001 4L10.5001 3L10.0001 4L9.00006 4.125L9.83406 4.833L9.50006 6L10.5001 5.334L11.5001 6L11.1661 4.833L12.0001 4.125L11.0001 4ZM19.3341 14.666L18.5001 13L17.6661 14.666L16.0001 14.875L17.3891 16.056L16.8341 18L18.5001 16.889L20.1661 18L19.6111 16.056L21.0001 14.875L19.3341 14.666ZM6.66706 6.333L6.00006 5L5.33306 6.333L4.00006 6.5L5.11106 7.444L4.66706 9L6.00006 8.111L7.33306 9L6.88906 7.444L8.00006 6.5L6.66706 6.333ZM3.41406 17C3.41406 17.534 3.62206 18.036 4.00006 18.414L5.58606 20C5.96406 20.378 6.46606 20.586 7.00006 20.586C7.53406 20.586 8.03606 20.378 8.41406 20L20.0001 8.414C20.3781 8.036 20.5861 7.534 20.5861 7C20.5861 6.466 20.3781 5.964 20.0001 5.586L18.4141 4C17.6581 3.244 16.3421 3.244 15.5861 4L4.00006 15.586C3.62206 15.964 3.41406 16.466 3.41406 17ZM17.0001 5.414L18.5861 7L15.0001 10.586L13.4141 9L17.0001 5.414Z"
          fill="currentColor"
        /> */}
        <path
          className="hidden"
          id="circle"
          fill="currentColor"
          d="M14 16V13.702L14.856 13.105C15.7298 12.4969 16.3868 11.6258 16.7311 10.6184C17.0755 9.61107 17.0894 8.5201 16.7708 7.50432C16.4521 6.48854 15.8175 5.60098 14.9595 4.97086C14.1014 4.34073 13.0646 4.00094 12 4.00094C10.9354 4.00094 9.89861 4.34073 9.04053 4.97086C8.18246 5.60098 7.5479 6.48854 7.22924 7.50432C6.91059 8.5201 6.92446 9.61107 7.26886 10.6184C7.61325 11.6258 8.27017 12.4969 9.144 13.105L10 13.702V16H11V7.99999C11 7.73477 11.1054 7.48042 11.2929 7.29288C11.4804 7.10535 11.7348 6.99999 12 6.99999C12.2652 6.99999 12.5196 7.10535 12.7071 7.29288C12.8946 7.48042 13 7.73477 13 7.99999V16H14ZM14 18H10V20H14V18ZM5 8.99999C5.00008 7.79636 5.31051 6.61308 5.90132 5.56443C6.49213 4.51578 7.34335 3.63719 8.37279 3.0135C9.40222 2.38981 10.5751 2.0421 11.7781 2.00395C12.9811 1.96579 14.1737 2.23849 15.2406 2.79569C16.3075 3.3529 17.2126 4.17579 17.8687 5.1849C18.5248 6.194 18.9096 7.35523 18.9859 8.55644C19.0623 9.75765 18.8276 10.9582 18.3045 12.0423C17.7815 13.1263 16.9878 14.0572 16 14.745V20C16 20.5304 15.7893 21.0391 15.4142 21.4142C15.0391 21.7893 14.5304 22 14 22H10C9.46957 22 8.96086 21.7893 8.58579 21.4142C8.21072 21.0391 8 20.5304 8 20V14.745C7.07341 14.1006 6.31657 13.2415 5.79415 12.2411C5.27173 11.2406 4.99926 10.1286 5 8.99999V8.99999Z"
        />
      </svg>
    </div>
  )
}

export default Cursor
